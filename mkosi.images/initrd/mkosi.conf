# SPDX-License-Identifier: LGPL-2.1-or-later

[Output]
Output=initrd
Format=cpio
ManifestFormat=
SplitArtifacts=

[Build]
Environment=
    SYSEXT_LEVEL=0
    CONFEXT_LEVEL=0

[Content]
Bootable=0
CleanPackageMetadata=1
MakeInitrd=1
Locale=C.UTF-8
WithDocs=0
Keymap=dvorak-programmer
PostInstallationScripts=
                        %D/mkosi.postinst.d/20-keymap.sh.chroot
                        %D/mkosi.postinst.d/90-release.sh.chroot

Packages=
        systemd
        btrfs-progs
        dosfstools
        erofs-utils
        less
        gzip            # Decompressing keymap files when calling loadkeys
        tpm2-tss        # unlock LUKS2 volumes with TPM2 token
        libfido2        # unlock LUKS2 volumes with FIDO2 token
        libp11-kit      # support PKCS#11

KernelModulesExclude=.*
RemoveFiles=
	# Remove unnecessary libraries pulled in from unsplit gcc-libs package
	/usr/lib/libgfortran.so*
	/usr/lib/libgo.so*
	/usr/lib/libgomp.so*
	/usr/lib/libgphobos.so*
	/usr/lib/libobjc.so*
	/usr/lib/libgdruntime.so*
	# Remove headers, static lib archives, sanitise libs and localization files
	/usr/lib/*.a
	/usr/include/*
	/usr/share/i18n/*
	/usr/share/hwdata/*
	/usr/share/iana-etc/*
	/usr/share/locale/*
	/usr/lib/libasan.so*
	/usr/lib/libtsan.so*
	/usr/lib/liblsan.so*
	/usr/lib/libubsan.so*
	# We don't need this after the binary catalogs have been built
	/usr/lib/systemd/catalog
	/etc/udev/hwdb.d
	/usr/lib/udev/hwdb.d
	# This is not needed by anything updated in the last 20 years
	/etc/services
    # Remove kernel images from initrd
    /usr/lib/modules/*/vmlinuz*
    /usr/lib/modules/*/vmlinux*
    /usr/lib/modules/*/System.map
    # This file is not reproducible so let's remove it to increase reproducibility of initrds
    /var/cache
    /var/log
